module.exports = [
  {
    id: 'P64:php:phpinfo',
    name: 'Matches any PHP script containing a call to phpinfo()',
    description: 'phpinfo() is a useful way of showing the current server configuration in a human-readable format, however is exposes some sensitive information to potential attackers. This rule detects PHP scripts that contain this function call as this could be the indication of a script created maliciously.',
    urls: null,
    deprecated: false,
    tags: ['suspicion', 'php', 'phpinfo'],

    tests: {
      // Some WordPress internal files include safe calls to phpinfo(), so exclude them
      path: (f) => (
        !!(
          f.match(/\.php$/i) &&
          !f.match(/wp-includes\/functions\.php$/i) &&
          !f.match(/wp-admin\/includes\/class-wp-filesystem-ssh2\.php$/i)
        )
      ),
      content: (content) => {
        return !!(content.match(/phpinfo\(/) && !content.match(/\/\/\s+phpinfo\(/));
      },
    }
  },
];
