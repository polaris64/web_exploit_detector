const Promise = require('bluebird');
const fs      = Promise.promisifyAll(require('graceful-fs'));

module.exports = [
  {
    id: 'P64:js:jquery:obfuscated_document_write',
    name: 'Matches any jquery JS scripts containing obfuscated code "write"',
    description: '',
    urls: ['https://www.polaris64.net/blog/cyber-security/2017/wordpress-hacks-jquery-js-script-injection'],
    deprecated: false,
    tags: ['js', 'jquery', 'obfuscation'],
    test: (f) => {
      if (!f.match(/jquery.*\.js$/i))
        return Promise.resolve(false);
      return fs.readFileAsync(f)
        .then(lines => lines.toString().match(/\\x77\\x72\\x69\\x74\\x65/i));
    },
  },
];
